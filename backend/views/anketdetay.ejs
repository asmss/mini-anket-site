<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>anket detay</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/css/anketdetay.css">
</head>
<body>
    <h1><%= anket.title %></h1>

  <form id="voteForm" action="/vote/<%= anket.id %>" method="POST">
    <% anket.options.forEach((option, i) => { %>
      <label>
        <input type="radio" name="optionIndex" value="<%= i %>" required />
        <%= option %>
      </label><br />
    <% }) %>
    <br />
    <button type="submit">Oy Ver</button>
  </form>

  <h2>Sonuclar</h2>
  <canvas id="resultsChart" width="400" height="200"></canvas>
<script>
  const options = <%- JSON.stringify(anket.options) %>;
  const votes = <%- JSON.stringify(anket.votes) %>;

  // Toplam oy sayısını hesapla
  const totalVotes = votes.reduce((acc, val) => acc + val, 0);

  // Yüzdeleri hesapla
  const votePercentages = votes.map(v => totalVotes > 0 ? ((v / totalVotes) * 100).toFixed(1) : 0);

  const ctx = document.getElementById('resultsChart').getContext('2d');
  const data = {
    labels: options.map((opt, i) => `${opt} - %${votePercentages[i]}`),
    datasets: [{
      label: 'Yüzdelik Dağılım',
      data: votePercentages,
      backgroundColor: [
        'rgba(54, 162, 235, 0.7)',
        'rgba(255, 99, 132, 0.7)',
        'rgba(255, 206, 86, 0.7)',
        'rgba(75, 192, 192, 0.7)',
        'rgba(153, 102, 255, 0.7)',
        'rgba(255, 159, 64, 0.7)',
        'rgba(201, 203, 207, 0.7)'
      ],
      borderWidth: 1
    }]
  };

  const config = {
    type: 'bar',
    data: data,
    options: {
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: { display: true, text: '%' }
        }
      },
     plugins: {
  tooltip: {
    callbacks: {
      label: function(context) {
        return `%${context.raw}`;
      }
    }
  }
}
    }
  };

  new Chart(ctx, config);
</script>

    <br>
    <button class="btn btn-primary" onclick="window.location.href='/'">Ana sayfaya dön</button>

</body>
</html>